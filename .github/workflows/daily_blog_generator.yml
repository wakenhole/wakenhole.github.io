name: Daily Blog Post Generator (KST 8 AM)

on:
  # ë§¤ì¼ UTC 23:00 ì— ì‹¤í–‰ (í•œêµ­ ì‹œê°„ KST 08:00)
  schedule:
    - cron: '0 23 * * *'
  # ìˆ˜ë™ ì‹¤í–‰ì„ ìœ„í•œ ì›Œí¬í”Œë¡œìš° ë””ìŠ¤íŒ¨ì¹˜ ì¶”ê°€
  workflow_dispatch:

jobs:
  generate_draft:
    runs-on: ubuntu-latest
    
    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

    steps:
      - name: 1. Checkout repository
        uses: actions/checkout@v4
        with:
          # ì´ë¯¸ì§€ URL êµ¬ì„±ì„ ìœ„í•´ ì „ì²´ íˆìŠ¤í† ë¦¬ ê°€ì ¸ì˜¤ê¸°
          fetch-depth: 0

      - name: 2. Set up Python 3.x
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: 3. Install dependencies
        run: pip install requests

      - name: 4. Run Topic and Content Generation Script
        # ì´ ë‹¨ê³„ì—ì„œ _posts/ íŒŒì¼ê³¼ assets/images/ íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.
        run: |
          python generate_blog_tech.py
          python generate_blog_invest.py
        
      - name: 5. Commit and Push Generated Files
        # ê¸€ íŒŒì¼(.md)ê³¼ ì´ë¯¸ì§€ íŒŒì¼(.png)ì„ ëª¨ë‘ ì»¤ë°‹í•©ë‹ˆë‹¤.
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email '41898282+github-actions[bot]@users.noreply.github.com'
          
          # ìƒˆë¡œìš´ íŒŒì¼ì´ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸ í›„ ì»¤ë°‹
          # _posts í´ë”ì˜ md íŒŒì¼ê³¼ assets/images í´ë”ì˜ png íŒŒì¼ì„ ëª¨ë‘ ì¶”ê°€í•©ë‹ˆë‹¤.
          if git status --porcelain | grep -qE '(_posts/|assets/images/)'; then
            git add _posts/*.md assets/images/*.png
            git commit -m "ğŸ¤– Chore: Daily draft & cover image generated for $(date -u +%Y-%m-%d --date='9 hour')"
            git push
            echo "âœ… íŒŒì¼ ì»¤ë°‹ ë° í‘¸ì‹œ ì™„ë£Œ."
          else
            echo "âš ï¸ ë³€ê²½ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤. ì»¤ë°‹ì„ ê±´ë„ˆëœë‹ˆë‹¤."
          fi
name: Daily Blog Topic Generator (KST 8 AM)

on:
  # ë§¤ì¼ UTC 23:00 ì— ì‹¤í–‰ (í•œêµ­ ì‹œê°„ KST 08:00)
  schedule:
    - cron: '0 23 * * *'
  # ìˆ˜ë™ ì‹¤í–‰ì„ ìœ„í•œ ì›Œí¬í”Œë¡œìš° ë””ìŠ¤íŒ¨ì¹˜ ì¶”ê°€
  workflow_dispatch:

jobs:
  generate_draft:
    runs-on: ubuntu-latest
    
    # í™˜ê²½ ë³€ìˆ˜ ì„¤ì •: Python ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‚¬ìš©
    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

    steps:
      - name: 1. Checkout repository
        uses: actions/checkout@v4

      - name: 2. Set up Python 3.x
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: 3. Install dependencies
        run: |
          # 'requests' ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•˜ì—¬ API í˜¸ì¶œì— ì‚¬ìš©í•©ë‹ˆë‹¤.
          pip install requests

      - name: 4. Run Topic Generation Script
        id: topic_gen
        run: python generate_topic.py
        # ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê²°ê³¼ë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ì €ì¥ (íŒŒì¼ëª… ì‚¬ìš©ì„ ìœ„í•´)
        # ìƒì„±ëœ íŒŒì¼ëª…ì´ YYYY-MM-DD-draft-topic.md í˜•ì‹ì´ë¯€ë¡œ, ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì»¤ë°‹ ë©”ì‹œì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
        
      - name: 5. Commit and Push new draft file
        # 'git config'ë¥¼ ì„¤ì •í•˜ì—¬ GitHub Actions ë´‡ì˜ ì´ë¦„ìœ¼ë¡œ ì»¤ë°‹í•©ë‹ˆë‹¤.
        run: |
          FILEPATH=_posts/$(date -u +%Y-%m-%d --date='9 hour')-draft-topic.md
          if [ -f "$FILEPATH" ]; then
            git config --global user.name 'GitHub Actions Bot'
            git config --global user.email '41898282+github-actions[bot]@users.noreply.github.com'
            git add _posts/*.md
            # ìƒì„±ëœ íŒŒì¼ëª…ì„ ì»¤ë°‹ ë©”ì‹œì§€ì— í¬í•¨
            git commit -m "ğŸ¤– Chore: Daily draft generated for $(date -u +%Y-%m-%d --date='9 hour')"
            git push
          else
            echo "Draft file not found. Skipping commit."
          fi


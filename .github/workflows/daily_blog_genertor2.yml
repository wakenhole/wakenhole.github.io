name: Daily Blog Post Generator All (KST 8 AM)

on:
  # schedule:
  #   - cron: '0 23 * * 0'
  workflow_dispatch:

jobs:
  generate_draft:
    runs-on: ubuntu-latest
    
    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

    steps:
      - name: 1. Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 2. Set up Python 3.x
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: 3. Install dependencies
        run: pip install requests

      - name: 4. Run Topic and Content Generation Script
        # íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•˜ì—¬ ë‹¤ì–‘í•œ ì£¼ì œì˜ ê¸€ì„ ìƒì„±í•©ë‹ˆë‹¤.
        run: |
          # 1. ê¸°ìˆ (Tech) ë¸”ë¡œê·¸ ê¸€ ìƒì„±
          python generate_post.py \
            --category "Tech" \
            --audience "ê°œë°œì" \
            --topic_keyword "ìµœì‹  IT ê¸°ìˆ  ë° ê°œë°œ íŠ¸ë Œë“œ" \
            --tags "ê¸°ìˆ , ê°œë°œ, Development, AI, Cloud"

          # 2. íˆ¬ì(Investment) ë¸”ë¡œê·¸ ê¸€ ìƒì„±
          python generate_post.py \
            --category "Investment" \
            --audience "ì£¼ì‹ íˆ¬ìì" \
            --topic_keyword "í•œêµ­, ë¯¸êµ­ ì£¼ì‹ ì‹œì¥ ë° ì„¸ê³„ ê²½ì œ ë‰´ìŠ¤" \
            --tags "ì£¼ì‹, ì¦ì‹œ, ê²½ì œ, Stock, Economy"
          
          # 3. íˆ¬ì(Investment) ë¸”ë¡œê·¸ ê¸€ ìƒì„±
          python generate_post.py \
            --category "ë¶€ë™ì‚°" \
            --audience "í•œêµ­ ë¶€ë™ì‚° íˆ¬ìì" \
            --topic_keyword "í•œêµ­ ë¶€ë™ì‚° ì •ì±… ë° ì œë„ ê´€ë ¨ ë‰´ìŠ¤" \
            --tags "ë¶€ë™ì‚°, ì •ì±…, ì œë„"
            
        #   # 4. ìê¸°ê³„ë°œ(Life) ê¸€ ìƒì„±
        #   # python generate_post.py \
        #     --category "Life" \ 
        #     --audience "ì§ì¥ì¸" \ 
        #     --topic_keyword "ìƒì‚°ì„± í–¥ìƒ íŒ" \ 
        #     --tags "Productivity"

      - name: 5. Commit and Push Generated Files
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email '41898282+github-actions[bot]@users.noreply.github.com'
          
          if git status --porcelain | grep -qE '(_posts/|assets/images/)'; then
            git add _posts/*.md assets/images/*.png
            git commit -m "ğŸ¤– Chore: Daily blog posts generated for $(date -u +%Y-%m-%d --date='9 hour')"
            git push
            echo "âœ… íŒŒì¼ ì»¤ë°‹ ë° í‘¸ì‹œ ì™„ë£Œ."
          else
            echo "âš ï¸ ë³€ê²½ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤. ì»¤ë°‹ì„ ê±´ë„ˆëœë‹ˆë‹¤."
          fi

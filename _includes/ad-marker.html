{% capture content_str %}{{ content }}{% endcapture %}
{% assign parts = content_str | split: '<!--ad-->' %}

{{ parts[0] }}
{% if page.ads != false and parts.size > 1 %}
  {% include ad-inpost.html %}
{% endif %}

{% assign rest = parts | slice: 1, parts.size %}
{% for seg in rest %}
  {{ seg }}
  {% if forloop.index0 < rest.size | minus: 1 and page.ads_repeat %}
    {% include ad-inpost.html %}
  {% endif %}
{% endfor %}